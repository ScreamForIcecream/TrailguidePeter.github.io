<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.76/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.76/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.76/Build/Cesium/Widgets/BaseLayerPicker/BaseLayerPicker.css" rel="stylesheet">

  <style type="text/css">
      html,
      body {
        margin: 0px;
        height: 100%;
        overflow: hidden;
      }

      #cesiumContainer {
        height: calc(100%);
      }

      .toolbar-left {
          display: block;
          position: absolute;
          bottom: 5px;
          left: 5px;
      }

      .button {
        background-color: rgba(50,50,50,0.8);
        border: 2px rgba(255,255,255,1);
        border-radius: 8px;
        color: white;
        padding: 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
      }

      .button:hover {
        background-color: rgba(80,151,191,0.8);
      }

      .button:active {
        transform: translateY(2px);
      }

  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div class="toolbar-left">
    <button class="button" onclick="getLocation()">Pos</button>
    <button class="button" onclick="alignView()">View</button>
  </div>
  <div id="baseLayerPickerContainer" style="position:absolute;top:24px;right:24px;width:38px;height:38px;"></div>
  <script>
    // Your access token can be found at: https://cesium.com/ion/tokens.
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5YTdlYWJkMC1kMmE1LTRiY2UtYTRhYy0wNWRmNGJmMGE0MTIiLCJpZCI6Mzk1MjEsImlhdCI6MTYwNzYwODYzMX0.QiNnF11wAMGQ-jbdbVDHWxDGfnHFV8u8t4VpwK98J6M';

    // Set the home view
    var extent = Cesium.Rectangle.fromDegrees(-23.168235,27.079881,53.131185,80.754928);

    Cesium.Camera.DEFAULT_VIEW_RECTANGLE = extent;
    Cesium.Camera.DEFAULT_VIEW_FACTOR = 0;

    // Create the available maps
    var imageryViewModels = [];
    imageryViewModels.push(new Cesium.ProviderViewModel({
         name : 'Trailguide',
         iconUrl : "https://res.cloudinary.com/dztnnl8x9/image/upload/v1607908467/mapthumbnail_trailguide_jxwzsb.png",
         tooltip : 'Trailguide topo map for summer sports',
         creationFunction : function() {
             return new Cesium.OpenStreetMapImageryProvider({
                 url : 'https://maps.trailguide.net/trailguidesummer/',
                 minimumLevel: 2,
                 maximumlevel: 18
             });
         }
     }));

     imageryViewModels.push(new Cesium.ProviderViewModel({
         name : 'Satellite',
         iconUrl : "https://res.cloudinary.com/dztnnl8x9/image/upload/v1607908467/mapthumbnail_satellite_a3fuzf.png",
         tooltip : 'Satellite pictures',
         creationFunction : function() {
             return new Cesium.IonImageryProvider({ assetId: 2 });
         }
     }));

     // Initialize the cesium container
     var viewer = new Cesium.Viewer('cesiumContainer', {
       imageryProviderViewModels : imageryViewModels,
       baseLayerPicker : true,
       animation : false,
       timeline : false,
       sceneModePicker: true,
       navigationHelpButton: false,
       fullscreenButton: false,
       navigationInstructionsInitiallyVisible: false,
       mapProjection : new Cesium.WebMercatorProjection(),
       useBrowserRecommendedResolution: true, // false decreases performance but resolution is better
       terrainExaggeration: 1,
       terrainProvider: Cesium.createWorldTerrain()
     });

    // kill the timeline and clock
    viewer.scene.frameState.creditDisplay.destroy();

    // hide geometries behind terrain
    viewer.scene.globe.depthTestAgainstTerrain = true;

    // Add Trailguide logo
    viewer.entities.add({
      position: Cesium.Cartesian3.fromDegrees(8.845, 60.685, 600),
      billboard: {
        image: "https://res.cloudinary.com/trailguide-as/image/upload/v1607637200/logo/trailguidewhite.png",
        scaleByDistance: new Cesium.NearFarScalar(0, 0.1, 1.5e5, 0.01),
        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 1.5e5),
      },
    });

    //Add mountain label & icon
    var terrainProvider = new Cesium.createWorldTerrain();

    var positions = [Cesium.Cartographic.fromDegrees(9.1352287, 60.5873951),];
    var promise = Cesium.sampleTerrainMostDetailed(terrainProvider, positions);
    Cesium.when(promise, function(updatedPositions) {

    	Cesium.when.all(
      [Cesium.Resource.fetchImage("https://res.cloudinary.com/dztnnl8x9/image/upload/v1607814557/triangular_hmbuda.png"),],
        function (images) {
          var facilityHeight = images[0].height;

            viewer.entities.add({
              name: "Kleverudnatten, 808m",
              position: Cesium.Cartesian3.fromRadians(positions[0].longitude, positions[0].latitude, positions[0].height+20),
              billboard: {
                color: Cesium.Color.fromBytes(90,90,90,200),
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                scaleByDistance: new Cesium.NearFarScalar(0, 0.25, 0.5e5, 0.03),
                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 0.5e5),
                image: images[0],
              },
              label: {
                text: "Kleverudnatten\n808m",
                font: "24px Arial",
                fillColor: Cesium.Color.fromBytes(90,90,90,220),
                //outlineColor: Cesium.Color.fromBytes(255,255,255,220),
                //outlineWidth: 1,
                //style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                pixelOffset: new Cesium.Cartesian2(0.0, -facilityHeight),
                pixelOffsetScaleByDistance: new Cesium.NearFarScalar(0, 0.6, 0.5e5, 0.05),
                scaleByDistance: new Cesium.NearFarScalar(0, 1, 0.5e5, 0.1),
                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 0.5e5),
                horizontalOrigin: Cesium.HorizontalOrigin.BOTTOM,
                backgroundPadding: new Cesium.Cartesian2(4, 3),
              },
            });
          });
        });

    // Add trailhead in form of a Billboard
    viewer.entities.add({
    	name: "Den Ravinde",
      position: Cesium.Cartesian3.fromDegrees(9.145262455567718,	60.57673305273056),
      billboard: {
        image: "https://res.cloudinary.com/dztnnl8x9/image/upload/v1607901172/trailhead_red_woxcny.png",
        scaleByDistance: new Cesium.NearFarScalar(0, 0.3, 0.5e5, 0.01),
        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 0.2e5),
        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
      },
    });

    // Add trail in form of a Polyline
    viewer.entities.add({
      polyline: {
        id: "Den Ravinde",
        positions: Cesium.Cartesian3.fromDegreesArray([
    				9.145262455567718,	60.57673305273056,
    				9.144597686827183,	60.57699339464307,
    				9.14363301359117,	60.57730997912586,
    				9.142594747245312,	60.577695462852716,
    				9.142127288505435,	60.57781674899161,
    				9.141684975475073,	60.577864022925496,
    				9.140925155952573,	60.5780762527138,
    				9.13976602256298,	60.57815202511847,
    				9.13948598317802,	60.57826300151646,
    				9.139142408967018,	60.57832905091345,
    				9.139115503057837,	60.57828923687339,
    				9.139441139996052,	60.57802830822766,
    				9.139398308470845,	60.577990002930164,
    				9.139165123924613,	60.57795572094619,
    				9.139828132465482,	60.57760418392718,
    				9.140051929280162,	60.5775114800781,
    				9.140300620347261,	60.577444173395634,
    				9.140383936464787,	60.577345602214336,
    				9.140795404091477,	60.57724451646209,
    				9.141192454844713,	60.57710680179298,
    				9.141813470050693,	60.576696088537574,
    				9.141250038519502,	60.576873030513525,
    				9.141652202233672,	60.57655904442072,
    				9.141860408708453,	60.57635033503175,
    				9.14199166931212,	60.57616911828518,
    				9.142053695395589,	60.57604255154729,
    				9.142264919355512,	60.575856724753976,
    				9.14143905043602,	60.57597876526415,
    				9.141053482890129,	60.576211446896195,
    				9.140787525102496,	60.57624530978501,
    				9.140907973051071,	60.57615394704044,
    				9.140937980264425,	60.57605101726949,
    				9.141000090166926,	60.57602268643677,
    				9.141088016331196,	60.57589603587985,
    				9.141087681055069,	60.5758504383266,
    				9.141213661059737,	60.57574801146984,
    				9.141440223902464,	60.57563845999539,
    				9.141361182555556,	60.57559797540307,
    				9.141051806509495,	60.5756931938231,
    				9.140660790726542,	60.57584582827985,
    				9.14025116711855,	60.57586242444813,
    				9.139866353943944,	60.576061913743615,
    				9.13940493017435,	60.576121509075165,
    				9.138667825609446,	60.57645318098366,
    				9.138276306912303,	60.57659978047013,
    				9.13785981014371,	60.57671528309584,
    				9.137595277279615,	60.57686850428581,
    				9.1374147310853,	60.57693178765476,
    				9.137249942868948,	60.576968835666776,
    				9.136934699490666,	60.57696615345776,
    				9.136609984561801,	60.577131025493145,
    				9.136346960440278,	60.577218029648066,
    				9.135966002941132,	60.57722297497094,
    				9.13585796020925,	60.5772440135479,
    				9.1357690282166,	60.577281983569264,
    				9.135630978271365,	60.57729204185307,
    				9.135780008509755,	60.577221969142556,
    				9.13613598793745,	60.57715700939298,
    				9.136334974318743,	60.577026000246406,
    				9.136360958218575,	60.5769710149616,
    				9.136486016213894,	60.576875964179635,
    				9.136806959286332,	60.57669499889016,
    				9.136826992034912,	60.57664596475661,
    				9.136551981791854,	60.5766980163753,
    				9.136132970452309,	60.576877975836396,
    				9.135469542816281,	60.576913934201,
    				9.135051621124148,	60.576842185109854,
    				9.134615007787943,	60.57688602246344,
    				9.134825393557549,	60.57680480182171,
    				9.13526376709342,	60.576686365529895,
    				9.135274412110448,	60.57663498446345,
    				9.134888425469398,	60.57669776491821,
    				9.134597824886441,	60.57670078240335,
    				9.134238576516509,	60.576872108504176,
    				9.134059622883797,	60.57690194807947,
    				9.133906569331884,	60.57688836939633,
    				9.134030789136887,	60.576833467930555,
    				9.13414721377194,	60.57680890895426,
    				9.134279815480113,	60.576739506796,
    				9.13430018350482,	60.576675636693835,
    				9.134187446907163,	60.57669868692756,
    				9.1340749617666,	60.57662702165544,
    				9.13410278968513,	60.576535323634744,
    				9.134107986465096,	60.57641261257231,
    				9.134086528792977,	60.57633583433926,
    				9.133959542959929,	60.576263666152954,
    				9.133793665096164,	60.57628168724477,
    				9.133498035371304,	60.57636399753392,
    				9.133233670145273,	60.57638084515929,
    				9.133485294878483,	60.57610860094428,
    				9.133818978443742,	60.575991002842784,
    				9.133955352008343,	60.57580702006817,
    				9.134588101878762,	60.57565472088754,
    				9.134674435481429,	60.57561566121876,
    				9.134691031649709,	60.57558900676668,
    				9.13464124314487,	60.5754376295954,
    				9.134816508740187,	60.57539756409824,
    				9.134854981675744,	60.57533302344382,
    				9.134392468258739,	60.57539521716535,
    				9.134908709675074,	60.57498534210026,
    				9.134943997487426,	60.57487738318741,
    				9.135288493707776,	60.57479037903249,
    				9.135249014943838,	60.574745032936335,
    				9.134750375524163,	60.57487914338708,
    				9.134711399674416,	60.57484268210828,
    				9.134804606437683,	60.57468409650028,
    				9.134775018319488,	60.57467018254101,
    				9.13449908606708,	60.57469004765153,
    				9.134303787723184,	60.57481116615236,
    				9.134240755811334,	60.574796414002776,
    				9.134238325059414,	60.57469641789794,
    				9.134085774421692,	60.57458896189928,
    				9.134083343669772,	60.574541771784425,
    				9.134321473538876,	60.57438159361482,
    				9.133955771103501,	60.57443859055638,
    				9.13359995931387,	60.574531964957714,
    				9.13319000042975,	60.5746069829911,
    				9.132912056520581,	60.574682001024485,
    				9.132779203355312,	60.57460228912532,
    				9.132822705432773,	60.574522158131,
    				9.133017668500543,	60.574406990781426,
    				9.133219923824072,	60.574252093210816,
    				9.13324423134327,	60.574198281392455,
    				9.133203914389014,	60.57415209710598,
    				9.132885066792369,	60.57427262887359,
    				9.132621958851814,	60.57423801161349,
    				9.132287185639143,	60.574447475373745,
    				9.132237732410431,	60.57455115951598,
    				9.131940007209778,	60.57461402378976,
    				9.131795587018132,	60.574687952175736,
    				9.131641024723649,	60.574660040438175,
    				9.131722245365381,	60.57462349534035,
    				9.131433991715312,	60.57460798881948,
    				9.1313655115664,	60.57459130883217,
    				9.131329972296953,	60.57456901296973,
    				9.131374899297953,	60.5745345633477,
    				9.131282027810812,	60.57450204156339,
    				9.131408091634512,	60.574313532561064,
    				9.131627781316638,	60.57417246513069,
    				9.131616381928325,	60.57413097470999,
    				9.131426699459553,	60.574140194803476,
    				9.131365260109305,	60.574101554229856,
    				9.131386131048203,	60.57404958643019,
    				9.131324775516987,	60.57399854063988,
    				9.13143340498209,	60.57392184622586,
        ]),
        clampToGround: true,
        width: 4,
        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 0.2e5),
        material: new Cesium.PolylineOutlineMaterialProperty({
          color: Cesium.Color.fromBytes(204,31,26,220),
          outlineWidth: 1,
          outlineColor: Cesium.Color.fromBytes(204,31,26,220),
        }),
      },
    });

    // fly into Map
    //viewer.camera.flyTo({
    //  destination : Cesium.Cartesian3.fromDegrees(9.12,	60.55, 2000),
    //  orientation : {
    //    heading : Cesium.Math.toRadians(10),
    //    pitch : Cesium.Math.toRadians(-25.0),
    //  }
    //});

</script>

<script>
// define varaibles
var icon;
var icontest = false;

function getDevice(a) {
  const mobile = /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4));
  const tablet = a.match(/(tablet|Tablet|iPad|Kindle|Silk|Nexus 7|Nexus 10)/g) ? true : false;
  if (mobile == true) return 'mobile';
  if (tablet == true) return 'tablet';
  return 'desktop';
}

function isMobile() {
  return getDevice(navigator.userAgent || navigator.vendor || window.opera) === 'mobile';
}
function isTablet() {
  return getDevice(navigator.userAgent || navigator.vendor || window.opera) === 'tablet';
}

function getLocation() {
  if (navigator.geolocation) {
    if (isMobile() || isTablet()) {

      window.alert("You are a phone");
      navigator.geolocation.getCurrentPosition(showPosition, {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 60000
      });

    } else { window.alert("You are no phone"); navigator.geolocation.getCurrentPosition(showPosition); }

  } else { window.alert("Can't get location"); }

}

function showPosition(position) {
  //window.alert(icontest);
  if (icontest) {
    icon.position = Cesium.Cartesian3.fromDegrees(position.coords.longitude, position.coords.latitude);
    icon.name = "Ele " + position.coords.altitude + ", \nLat " + position.coords.latitude.toFixed(5) + ", \nLon " + position.coords.longitude.toFixed(5);
    //window.alert("Location updated");
  } else {

    //window.alert("Latitude: " + position.coords.latitude +
    //"\nLongitude: " + position.coords.longitude);

    // Add location icon
    icon = viewer.entities.add({
      name: "Ele " + position.coords.altitude + ", \nLat " + position.coords.latitude.toFixed(5) +
      ", \nLon " + position.coords.longitude.toFixed(5),
      position: Cesium.Cartesian3.fromDegrees(position.coords.longitude, position.coords.latitude),
      billboard: {
        image: "https://res.cloudinary.com/dztnnl8x9/image/upload/v1607955354/position_kxc2vq.png",
        color : new Cesium.Color(1.0, 1.0, 1.0, 0.8),
        scaleByDistance: new Cesium.NearFarScalar(0, 0.3, 1e6, 0.1),
        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 1e6),
        verticalOrigin: Cesium.VerticalOrigin.CENTER,
        heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
        disableDepthTestDistance : Number.POSITIVE_INFINITY,
      },
    });

    icontest = true;
    //window.alert(icontest);

  }

  // fly into Map
  viewer.camera.flyTo({
    duration: 0.8,
    destination : Cesium.Cartesian3.fromDegrees(position.coords.longitude, position.coords.latitude, 3000)
  });

}
</script>

<script>
  // Adjust view to look straight down and top screen border points north
  function alignView() {
    var currentPosition = viewer.camera.positionCartographic;
    viewer.camera.flyTo({
      duration: 0.2,
      destination : Cesium.Cartesian3.fromRadians(currentPosition.longitude, currentPosition.latitude, currentPosition.height),
      orientation: {
        heading: 0,
        pitch: -1.5707963267948966192313216916398,
        roll: 0,
      },
    });
  }
</script>

 </div>
</body>
</html>
